<%--

Copyright (c) 2012, The University of Edinburgh.
All Rights Reserved

--%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
<%@ taglib prefix="utils" uri="http://www.ph.ed.ac.uk/utils" %>
<%--

This fragment formats the items reported within AbstractValidationResult.

Model attributes:

validationResult - current validationResult

--%>
<c:set var="resolvedAssessmentObject" value="${validationResult.resolvedAssessmentObject}"/>
<c:set var="rootObjectLookup" value="${resolvedAssessmentObject.rootObjectLookup}"/>
<c:set var="qtiXmlObjectReadResult" value="${rootObjectLookup.rootObjectHolder}"/>
<c:choose>
  <c:when test="${qtiXmlObjectReadResult==null}">
    <%-- Did not get this far --%>
  </c:when>
  <c:when test="${empty validationResult.errors && empty validationResult.warnings}">
    <div class="resultPanel success">
      <h3>JQTI+ validation succeeded</h3>
      <div class="details">
        <p>
          Additional validation of the resulting JQTI+ model of your XML was successful.
        </p>
      </div>
    </div>
  </c:when>
  <c:otherwise>
    <div class="resultPanel failure">
      <h3>JQTI+ validation failure</h3>
      <div class="details">
        <p>
          Additional validation of the resulting JQTI+ model detected some
          errors and/or warnings:
        </p>
        <table>
          <thead>
            <tr>
              <th class="center">Severity</th>
              <th class="center">Node</th>
              <th class="center">Line number</th>
              <th class="center">Column number</th>
              <th>Message</th>
            </tr>
          </thead>
          <tbody>
            <c:forEach var="i" items="${validationResult.errors}">
              <tr>
               <td class="center">Error</td>
               <td class="center">${i.node.classTag}</td>
               <td class="center">${i.node.sourceLocation.lineNumber}</td>
               <td class="center">${i.node.sourceLocation.columnNumber}</td>
               <td><c:out value="${i.message}"/></td>
              </tr>
            </c:forEach>
            <c:forEach var="i" items="${validationResult.warnings}">
              <tr>
               <td class="center">Warning</td>
               <td class="center">${i.node.classTag}</td>
               <td class="center">${i.node.sourceLocation.lineNumber}</td>
               <td class="center">${i.node.sourceLocation.columnNumber}</td>
               <td><c:out value="${i.message}"/></td>
              </tr>
            </c:forEach>
          </tbody>
        </table>
      </div>
    </div>
  </c:otherwise>
</c:choose>
